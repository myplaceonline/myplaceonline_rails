<% content_for :heading do -%><%= Myp.website_domain.domain_name %><% end -%>

<%
show_myplets = false
%>

<% if !user_signed_in? %>

  <%
  homepage = Myp.website_domain_homepage
  if homepage.is_a?(Hash)
  
    domain = homepage[:domain]
    
    if !domain.only_homepage
      # Assume that the view will have flashes!
      Rails.logger.debug{"welcome index hash: #{Myp.debug_print(homepage)}"}
      MyplaceonlineExecutionContext.do_ability_identity(homepage[:obj].identity) do
  %>
        <%= render :html => Myp.renderActionInOtherController(
                              homepage[:controller_class],
                              homepage[:action],
                              homepage[:params],
                            ).html_safe
        %>
  <%
      end
    end
  else
  %>
    <%= flashes! %>
    <%= raw(homepage) %>
  <%
  end
  %>

<% else %>

  <%
  show_myplets = true
  %>

<% end %>

<% if show_myplets %>

  <%= flashes! %>
  
  <% @myplets.each do |myplet| %>
    <%= render :html => Myp.renderActionInOtherController(
                          Object.const_get(myplet.category_name.camelize + "Controller"),
                          myplet.category_id.nil? ? :index : :show,
                          {
                            id: myplet.category_id,
                            myplet: myplet
                          }
                        ).html_safe
    %>
  <% end %>

<% end %>
